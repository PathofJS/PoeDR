<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoE Damage Calculator (Dark Mode)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #1a1a1a; /* Dark background */
            color: #e0e0e0; /* Light text */
            line-height: 1.4;
        }
        .container {
            background-color: #2a2a2a; /* Slightly lighter dark background for container */
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); /* Darker shadow */
            max-width: 960px;
            margin: 20px auto;
            box-sizing: border-box;
        }
        h1 {
            color: #f0f0f0; /* Lighter heading color */
            text-align: center;
            margin-top: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .input-group {
            margin-bottom: 10px;
            flex-basis: 100%;
        }
        .input-group label {
            display: block;
            margin-bottom: 3px;
            font-weight: bold;
            font-size: 0.95em;
            color: #e0e0e0; /* Light label text */
        }
        .input-group input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 5px;
            background: #555; /* Darker range track */
            outline: none;
            opacity: 0.8; /* Slightly less opaque */
            transition: opacity .2s;
        }
        .input-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #66bb6a; /* Green thumb for good contrast */
            cursor: pointer;
        }
        .input-group input[type="range"][readonly] {
            background: #444; /* Darker background for readonly range */
            cursor: default;
        }
        .input-group input[type="range"][readonly]::-webkit-slider-thumb {
            background: #777; /* Darker thumb for readonly range */
            cursor: default;
        }

        .input-group input[type="number"] {
            width: calc(100% - 16px);
            padding: 6px 8px;
            border: 1px solid #555; /* Darker border */
            border-radius: 4px;
            font-size: 15px;
            background-color: #3a3a3a; /* Dark input background */
            color: #f0f0f0; /* Light input text */
        }
        .output-group {
            margin-top: 20px;
            padding: 10px;
            background-color: #385038; /* Darker green for output */
            border: 1px solid #5a705a; /* Darker green border */
            border-radius: 8px;
            text-align: center;
            clear: both;
            width: 100%;
            box-sizing: border-box;
            position: sticky;
            bottom: 0;
            z-index: 100;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); /* Darker shadow */
            color: #f0f0f0; /* Light text for output */
        }
        .output-group p {
            margin: 5px 0;
        }
        .output-group strong {
            font-size: 1.3em;
            color: #8bc34a; /* Lighter green for strong text */
        }
        .output-group span {
            font-size: 0.9em;
            color: #d0d0d0; /* Slightly darker light text */
        }
        .section-header {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
            color: #bbb; /* Lighter grey for section headers */
            border-bottom: 1px solid #444; /* Darker border */
            padding-bottom: 3px;
        }

        /* Flexbox styling for paired inputs (2 per row) */
        .elemental-pair,
        .physical-pair {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 10px;
            background-color: #333; /* Darker background for input sections */
            padding: 10px;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1); /* Darker inset shadow */
        }
        .elemental-pair .input-group,
        .physical-pair .input-group {
            margin-bottom: 0;
            flex-basis: calc(50% - 7.5px);
        }

        /* New Flexbox styling for 3 inputs in a row */
        .three-column-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 10px;
            background-color: #333; /* Darker background for input sections */
            padding: 10px;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1); /* Darker inset shadow */
        }
        .three-column-row .input-group {
            margin-bottom: 0;
            flex-basis: calc((100% - 30px) / 3);
        }
        .three-column-row .input-group input[type="number"],
        .three-column-row .input-group input[type="range"] {
            width: calc(100% - 16px);
        }

        /* Adjust width for number inputs inside the flex items that have 2 columns */
        .elemental-pair .input-group input[type="number"],
        .physical-pair .input-group input[type="number"] {
            width: calc(100% - 16px);
        }

        /* Additional output for Armour's dynamic PDR */
        #armourPDRDisplay {
            font-size: 0.8em;
            color: #aaa; /* Lighter grey for sub-info */
            margin-top: 3px;
        }

        /* Media Queries for Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                margin: 0;
            }
            .container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
                padding: 10px;
            }
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            .input-group label {
                font-size: 0.9em;
            }
            .input-group input[type="number"],
            .input-group input[type="range"] {
                font-size: 14px;
            }

            .elemental-pair,
            .physical-pair,
            .three-column-row {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            .elemental-pair .input-group,
            .physical-pair .input-group,
            .three-column-row .input-group {
                flex-basis: 100%;
                margin-bottom: 0;
            }
            .output-group {
                padding: 8px;
                font-size: 0.9em;
            }
            .output-group strong {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Path of Exile Physical Damage Reduction Calculator</h1>

        <div class="section-header">Incoming Damage & Physical Mitigation</div>

        <div class="input-group">
            <label for="incomingPhysDamage">Incoming Physical Damage:</label>
            <input type="number" id="incomingPhysDamage" min="0" value="1000">
        </div>

        <div class="physical-pair">
            <div class="input-group">
                <label for="armour">Armour:</label>
                <input type="number" id="armour" min="0" value="0">
                <div id="armourPDRDisplay"></div>
            </div>
            <div class="input-group">
                <label for="totalPhysDR">Total Physical DR (%): <span id="totalPhysDRValue">0</span>%</label>
                <input type="range" id="totalPhysDR" min="0" max="90" value="0" readonly>
            </div>
        </div>

        <div class="three-column-row">
            <div class="input-group">
                <label for="otherPhysDR">Other Phys DR (%):</label>
                <input type="number" id="otherPhysDR" min="0" max="90" value="0">
            </div>

            <div class="input-group">
                <label for="enduranceCharges">Endurance Charges: <span id="enduranceChargesValue">0</span></label>
                <input type="range" id="enduranceCharges" min="0" max="12" value="0">
            </div>

            <div class="input-group">
                <label for="flatPhysTaken">Flat Phys Taken:</label>
                <input type="number" id="flatPhysTaken" min="0" value="0">
            </div>
        </div>


        <div class="section-header">Damage Conversion & Resistances</div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenFire">% Phys to Fire:</label>
                <input type="number" id="physTakenFire" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="fireResist">Fire Resist (%): <span id="fireResistValue">75</span>%</label>
                <input type="range" id="fireResist" min="0" max="90" value="75">
            </div>
        </div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenCold">% Phys to Cold:</label>
                <input type="number" id="physTakenCold" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="coldResist">Cold Resist (%): <span id="coldResistValue">75</span>%</label>
                <input type="range" id="coldResist" min="0" max="90" value="75">
            </div>
        </div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenLightning">% Phys to Lightning:</label>
                <input type="number" id="physTakenLightning" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="lightningResist">Lightning Resist (%): <span id="lightningResistValue">75</span>%</label>
                <input type="range" id="lightningResist" min="0" max="90" value="75">
            </div>
        </div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenChaos">% Phys to Chaos:</label>
                <input type="number" id="physTakenChaos" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="chaosResist">Chaos Resist (%): <span id="chaosResistValue">0</span>%</label>
                <input type="range" id="chaosResist" min="-60" max="90" value="0">
            </div>
        </div>

    </div>

    <div class="output-group">
        <p>Final Damage Received: <strong id="finalDamage">0</strong></p>
        <p> (Breakdown: <span id="finalPhysDmg">0</span> Physical, <span id="finalFireDmg">0</span> Fire, <span id="finalColdDmg">0</span> Cold, <span id="finalLightningDmg">0</span> Lightning, <span id="finalChaosDmg">0</span> Chaos)</p>
    </div>

    <script>
        const totalPhysDRDisplayInput = document.getElementById('totalPhysDR');
        const totalPhysDRValueSpan = document.getElementById('totalPhysDRValue');
        const incomingPhysDamageInput = document.getElementById('incomingPhysDamage');
        const enduranceChargesInput = document.getElementById('enduranceCharges');
        const enduranceChargesValueSpan = document.getElementById('enduranceChargesValue');
        const flatPhysTakenInput = document.getElementById('flatPhysTaken');
        const physTakenFireInput = document.getElementById('physTakenFire');
        const physTakenColdInput = document.getElementById('physTakenCold');
        const physTakenLightningInput = document.getElementById('physTakenLightning');
        const physTakenChaosInput = document.getElementById('physTakenChaos');
        const otherPhysDRInput = document.getElementById('otherPhysDR');
        const fireResistInput = document.getElementById('fireResist');
        const fireResistValueSpan = document.getElementById('fireResistValue');
        const coldResistInput = document.getElementById('coldResist');
        const coldResistValueSpan = document.getElementById('coldResistValue');
        const lightningResistInput = document.getElementById('lightningResist');
        const lightningResistValueSpan = document.getElementById('lightningResistValue');
        const chaosResistInput = document.getElementById('chaosResist');
        const chaosResistValueSpan = document.getElementById('chaosResistValue');
        const armourInput = document.getElementById('armour');
        const armourPDRDisplay = document.getElementById('armourPDRDisplay');
        const finalDamageOutput = document.getElementById('finalDamage');
        const finalPhysDmgSpan = document.getElementById('finalPhysDmg');
        const finalFireDmgSpan = document.getElementById('finalFireDmg');
        const finalColdDmgSpan = document.getElementById('finalColdDmg');
        const finalLightningDmgSpan = document.getElementById('finalLightningDmg');
        const finalChaosDmgSpan = document.getElementById('finalChaosDmg');


        function calculateDamage() {
            let incomingDamage = parseFloat(incomingPhysDamageInput.value) || 0;
            let enduranceCharges = parseInt(enduranceChargesInput.value) || 0;
            let flatPhysTaken = parseFloat(flatPhysTakenInput.value) || 0;
            let physTakenFire = parseFloat(physTakenFireInput.value) || 0;
            let physTakenCold = parseFloat(physTakenColdInput.value) || 0;
            let physTakenLightning = parseFloat(physTakenLightningInput.value) || 0;
            let physTakenChaos = parseFloat(physTakenChaosInput.value) || 0;
            let armour = parseFloat(armourInput.value) || 0;
            let otherPhysDR = parseFloat(otherPhysDRInput.value) || 0;
            let fireResist = parseFloat(fireResistInput.value) || 0;
            let coldResist = parseFloat(coldResistInput.value) || 0;
            let lightningResist = parseFloat(lightningResistInput.value) || 0;
            let chaosResist = parseFloat(chaosResistInput.value) || 0;

            enduranceChargesValueSpan.textContent = enduranceCharges;
            fireResistValueSpan.textContent = fireResist;
            coldResistValueSpan.textContent = coldResist;
            lightningResistValueSpan.textContent = lightningResist;
            chaosResistValueSpan.textContent = chaosResist;

            // Ensure total conversion doesn't exceed 100% (optional, but good practice for PoE mechanics)
            let totalConversionPercent = physTakenFire + physTakenCold + physTakenLightning + physTakenChaos;
            if (totalConversionPercent > 100) {
                let ratio = 100 / totalConversionPercent;
                physTakenFire *= ratio;
                physTakenCold *= ratio;
                physTakenLightning *= ratio;
                physTakenChaos *= ratio;
                // Update input values to reflect the adjusted conversion percentages
                physTakenFireInput.value = physTakenFire.toFixed(2);
                physTakenColdInput.value = physTakenCold.toFixed(2);
                physTakenLightningInput.value = physTakenLightning.toFixed(2);
                physTakenChaosInput.value = physTakenChaos.toFixed(2);
            }

            let damageConvertedToFire = incomingDamage * (physTakenFire / 100);
            let damageConvertedToCold = incomingDamage * (physTakenCold / 100);
            let damageConvertedToLightning = incomingDamage * (physTakenLightning / 100);
            let damageConvertedToChaos = incomingDamage * (physTakenChaos / 100);

            let rawPhysicalDamageAfterConversion = Math.max(0, incomingDamage - (damageConvertedToFire + damageConvertedToCold + damageConvertedToLightning + damageConvertedToChaos));

            let armourPDR = 0;
            if (rawPhysicalDamageAfterConversion > 0 && armour > 0) {
                armourPDR = (armour / (armour + (10 * rawPhysicalDamageAfterConversion))) * 100;
                armourPDR = Math.min(90, armourPDR);
            }
            armourPDRDisplay.textContent = `PDR from Armour: ${armourPDR.toFixed(2)}% (vs ${rawPhysicalDamageAfterConversion.toFixed(0)} phys)`;

            let endurancePhysDR = enduranceCharges * 4;
            let combinedPhysicalDR = armourPDR + endurancePhysDR + otherPhysDR;
            combinedPhysicalDR = Math.min(90, combinedPhysicalDR);

            totalPhysDRDisplayInput.value = combinedPhysicalDR;
            totalPhysDRValueSpan.textContent = combinedPhysicalDR.toFixed(2);

            let effectivePhysicalDamage = rawPhysicalDamageAfterConversion * (1 - (combinedPhysicalDR / 100));
            effectivePhysicalDamage = Math.max(0, effectivePhysicalDamage - flatPhysTaken);

            let mitigatedFireDamage = damageConvertedToFire * (1 - (fireResist / 100));
            let mitigatedColdDamage = damageConvertedToCold * (1 - (coldResist / 100));
            let mitigatedLightningDamage = damageConvertedToLightning * (1 - (lightningResist / 100));
            let mitigatedChaosDamage = damageConvertedToChaos * (1 - (chaosResist / 100));

            // Endurance Charges provide 4% Physical Damage Reduction per charge and 4% Elemental Resistance per charge.
            // They do NOT provide Chaos Resistance.
            let enduranceEleDRFactor = (1 - (enduranceCharges * 0.04));
            enduranceEleDRFactor = Math.max(0, enduranceEleDRFactor);

            mitigatedFireDamage *= enduranceEleDRFactor;
            mitigatedColdDamage *= enduranceEleDRFactor;
            mitigatedLightningDamage *= enduranceEleDRFactor;

            let finalDamage = effectivePhysicalDamage + mitigatedFireDamage + mitigatedColdDamage + mitigatedLightningDamage + mitigatedChaosDamage;

            finalDamageOutput.textContent = finalDamage.toFixed(2);
            finalPhysDmgSpan.textContent = effectivePhysicalDamage.toFixed(2);
            finalFireDmgSpan.textContent = mitigatedFireDamage.toFixed(2);
            finalColdDmgSpan.textContent = mitigatedColdDamage.toFixed(2);
            finalLightningDmgSpan.textContent = mitigatedLightningDamage.toFixed(2);
            finalChaosDmgSpan.textContent = mitigatedChaosDamage.toFixed(2);
        }

        incomingPhysDamageInput.addEventListener('input', calculateDamage);
        enduranceChargesInput.addEventListener('input', calculateDamage);
        flatPhysTakenInput.addEventListener('input', calculateDamage);
        physTakenFireInput.addEventListener('input', calculateDamage);
        physTakenColdInput.addEventListener('input', calculateDamage);
        physTakenLightningInput.addEventListener('input', calculateDamage);
        physTakenChaosInput.addEventListener('input', calculateDamage);
        armourInput.addEventListener('input', calculateDamage);
        otherPhysDRInput.addEventListener('input', calculateDamage);
        fireResistInput.addEventListener('input', calculateDamage);
        coldResistInput.addEventListener('input', calculateDamage);
        lightningResistInput.addEventListener('input', calculateDamage);
        chaosResistInput.addEventListener('input', calculateDamage);

        calculateDamage();
    </script>
</body>
</html>
