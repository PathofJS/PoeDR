<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoE Damage Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0; /* Remove default body margin */
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.4; /* Slightly reduce line height for compactness */
        }
        .container {
            background-color: #fff;
            padding: 15px; /* Reduced padding */
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 960px; /* Increased max-width for PC */
            margin: 20px auto; /* Add margin for PC view */
            box-sizing: border-box; /* Include padding in width */
        }
        h1 {
            color: #333;
            text-align: center;
            margin-top: 10px; /* Reduced top margin */
            margin-bottom: 20px; /* Reduced bottom margin */
            font-size: 1.8em; /* Slightly smaller for compactness */
        }
        .input-group {
            margin-bottom: 10px; /* Reduced margin */
            flex-basis: 100%;
        }
        .input-group label {
            display: block;
            margin-bottom: 3px; /* Reduced margin */
            font-weight: bold;
            font-size: 0.95em; /* Slightly smaller font for labels */
        }
        .input-group input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 6px; /* Thinner slider */
            border-radius: 5px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        .input-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px; /* Slightly smaller thumb */
            height: 18px; /* Slightly smaller thumb */
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        .input-group input[type="range"][readonly] {
            background: #e0e0e0;
            cursor: default;
        }
        .input-group input[type="range"][readonly]::-webkit-slider-thumb {
            background: #888;
            cursor: default;
        }

        .input-group input[type="number"] {
            width: calc(100% - 16px); /* Adjust width for padding */
            padding: 6px 8px; /* Reduced padding */
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 15px; /* Slightly smaller font */
        }
        .output-group {
            margin-top: 20px; /* Reduced margin */
            padding: 10px; /* Reduced padding */
            background-color: #e9ffe9;
            border: 1px solid #c9f0c9;
            border-radius: 8px;
            text-align: center;
            clear: both;
            width: 100%;
            box-sizing: border-box;
            position: sticky; /* Make it sticky */
            bottom: 0; /* Stick to the bottom */
            z-index: 100; /* Ensure it's above other content */
            border-bottom-left-radius: 0; /* Remove bottom border radius for sticky effect */
            border-bottom-right-radius: 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05); /* Shadow for sticky effect */
        }
        .output-group p {
            margin: 5px 0; /* Reduced margin for paragraphs */
        }
        .output-group strong {
            font-size: 1.3em; /* Slightly smaller font for final damage */
            color: #28a745;
        }
        .output-group span {
            font-size: 0.9em; /* Smaller font for breakdown */
        }
        .section-header {
            margin-top: 20px; /* Reduced top margin */
            margin-bottom: 10px; /* Reduced bottom margin */
            font-size: 1.1em; /* Slightly smaller font */
            font-weight: bold;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 3px; /* Reduced padding */
        }

        /* Flexbox styling for paired inputs (2 per row) */
        .elemental-pair,
        .physical-pair {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px; /* Reduced gap */
            margin-bottom: 10px; /* Reduced margin */
            background-color: #eeeeee;
            padding: 10px; /* Reduced padding */
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.03); /* Lighter shadow */
        }
        .elemental-pair .input-group,
        .physical-pair .input-group {
            margin-bottom: 0;
            flex-basis: calc(50% - 7.5px); /* Adjusted flex-basis for smaller gap */
        }

        /* New Flexbox styling for 3 inputs in a row */
        .three-column-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px; /* Reduced gap */
            margin-bottom: 10px; /* Reduced margin */
            background-color: #eeeeee;
            padding: 10px; /* Reduced padding */
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.03); /* Lighter shadow */
        }
        .three-column-row .input-group {
            margin-bottom: 0;
            flex-basis: calc((100% - 30px) / 3); /* Adjusted flex-basis for smaller gap */
        }
        .three-column-row .input-group input[type="number"],
        .three-column-row .input-group input[type="range"] {
            width: calc(100% - 16px); /* Adjust width for padding */
        }

        /* Adjust width for number inputs inside the flex items that have 2 columns */
        .elemental-pair .input-group input[type="number"],
        .physical-pair .input-group input[type="number"] {
            width: calc(100% - 16px); /* Adjust width for padding */
        }

        /* Additional output for Armour's dynamic PDR */
        #armourPDRDisplay {
            font-size: 0.8em; /* Smaller font */
            color: #666;
            margin-top: 3px; /* Reduced margin */
        }

        /* Media Queries for Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                margin: 0; /* Remove side margins on small screens */
            }
            .container {
                margin: 0; /* Remove top/bottom margins on small screens */
                border-radius: 0; /* No border-radius on full screen mobile */
                box-shadow: none; /* No shadow on full screen mobile */
                padding: 10px; /* Further reduced padding */
            }
            h1 {
                font-size: 1.5em; /* Smaller heading on mobile */
                margin-bottom: 15px;
            }
            .input-group label {
                font-size: 0.9em; /* Even smaller font for labels on mobile */
            }
            .input-group input[type="number"],
            .input-group input[type="range"] {
                font-size: 14px; /* Smaller font size for inputs on mobile */
            }

            .elemental-pair,
            .physical-pair,
            .three-column-row {
                flex-direction: column; /* Stack elements vertically on mobile */
                gap: 10px; /* Smaller gap when stacked */
                padding: 10px; /* Consistent padding */
            }
            .elemental-pair .input-group,
            .physical-pair .input-group,
            .three-column-row .input-group {
                flex-basis: 100%; /* Take full width when stacked */
                margin-bottom: 0;
            }
            .output-group {
                padding: 8px; /* Further reduced padding for output */
                font-size: 0.9em; /* Smaller font for output on mobile */
            }
            .output-group strong {
                font-size: 1.2em; /* Adjusted strong text size */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Path of Exile Physical Damage Reduction Calculator</h1>

        <div class="section-header">Incoming Damage & Physical Mitigation</div>

        <div class="input-group">
            <label for="incomingPhysDamage">Incoming Physical Damage:</label>
            <input type="number" id="incomingPhysDamage" min="0" value="1000">
        </div>

        <div class="physical-pair">
            <div class="input-group">
                <label for="armour">Armour:</label>
                <input type="number" id="armour" min="0" value="0">
                <div id="armourPDRDisplay"></div>
            </div>
            <div class="input-group">
                <label for="totalPhysDR">Total Physical DR (%): <span id="totalPhysDRValue">0</span>%</label>
                <input type="range" id="totalPhysDR" min="0" max="90" value="0" readonly>
            </div>
        </div>

        <div class="three-column-row">
            <div class="input-group">
                <label for="otherPhysDR">Other Phys DR (%):</label>
                <input type="number" id="otherPhysDR" min="0" max="90" value="0">
            </div>

            <div class="input-group">
                <label for="enduranceCharges">Endurance Charges: <span id="enduranceChargesValue">0</span></label>
                <input type="range" id="enduranceCharges" min="0" max="12" value="0">
            </div>

            <div class="input-group">
                <label for="flatPhysTaken">Flat Phys Taken:</label>
                <input type="number" id="flatPhysTaken" min="0" value="0">
            </div>
        </div>


        <div class="section-header">Elemental Damage Conversion & Resistances</div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenFire">% Phys to Fire:</label>
                <input type="number" id="physTakenFire" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="fireResist">Fire Resist (%): <span id="fireResistValue">75</span>%</label>
                <input type="range" id="fireResist" min="0" max="90" value="75">
            </div>
        </div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenCold">% Phys to Cold:</label>
                <input type="number" id="physTakenCold" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="coldResist">Cold Resist (%): <span id="coldResistValue">75</span>%</label>
                <input type="range" id="coldResist" min="0" max="90" value="75">
            </div>
        </div>

        <div class="elemental-pair">
            <div class="input-group">
                <label for="physTakenLightning">% Phys to Lightning:</label>
                <input type="number" id="physTakenLightning" min="0" max="100" value="0">
            </div>
            <div class="input-group">
                <label for="lightningResist">Lightning Resist (%): <span id="lightningResistValue">75</span>%</label>
                <input type="range" id="lightningResist" min="0" max="90" value="75">
            </div>
        </div>

        </div>

    <div class="output-group">
        <p>Final Damage Received: <strong id="finalDamage">0</strong></p>
        <p> (Breakdown: <span id="finalPhysDmg">0</span> Physical, <span id="finalFireDmg">0</span> Fire, <span id="finalColdDmg">0</span> Cold, <span id="finalLightningDmg">0</span> Lightning)</p>
    </div>

    <script>
        const totalPhysDRDisplayInput = document.getElementById('totalPhysDR');
        const totalPhysDRValueSpan = document.getElementById('totalPhysDRValue');
        const incomingPhysDamageInput = document.getElementById('incomingPhysDamage');
        const enduranceChargesInput = document.getElementById('enduranceCharges');
        const enduranceChargesValueSpan = document.getElementById('enduranceChargesValue');
        const flatPhysTakenInput = document.getElementById('flatPhysTaken');
        const physTakenFireInput = document.getElementById('physTakenFire');
        const physTakenColdInput = document.getElementById('physTakenCold');
        const physTakenLightningInput = document.getElementById('physTakenLightning');
        const otherPhysDRInput = document.getElementById('otherPhysDR');
        const fireResistInput = document.getElementById('fireResist');
        const fireResistValueSpan = document.getElementById('fireResistValue');
        const coldResistInput = document.getElementById('coldResist');
        const coldResistValueSpan = document.getElementById('coldResistValue');
        const lightningResistInput = document.getElementById('lightningResist');
        const lightningResistValueSpan = document.getElementById('lightningResistValue');
        const armourInput = document.getElementById('armour');
        const armourPDRDisplay = document.getElementById('armourPDRDisplay');
        const finalDamageOutput = document.getElementById('finalDamage');
        const finalPhysDmgSpan = document.getElementById('finalPhysDmg');
        const finalFireDmgSpan = document.getElementById('finalFireDmg');
        const finalColdDmgSpan = document.getElementById('finalColdDmg');
        const finalLightningDmgSpan = document.getElementById('finalLightningDmg');


        function calculateDamage() {
            let incomingDamage = parseFloat(incomingPhysDamageInput.value) || 0;
            let enduranceCharges = parseInt(enduranceChargesInput.value) || 0;
            let flatPhysTaken = parseFloat(flatPhysTakenInput.value) || 0;
            let physTakenFire = parseFloat(physTakenFireInput.value) || 0;
            let physTakenCold = parseFloat(physTakenColdInput.value) || 0;
            let physTakenLightning = parseFloat(physTakenLightningInput.value) || 0;
            let armour = parseFloat(armourInput.value) || 0;
            let otherPhysDR = parseFloat(otherPhysDRInput.value) || 0;
            let fireResist = parseFloat(fireResistInput.value) || 0;
            let coldResist = parseFloat(coldResistInput.value) || 0;
            let lightningResist = parseFloat(lightningResistInput.value) || 0;

            enduranceChargesValueSpan.textContent = enduranceCharges;
            fireResistValueSpan.textContent = fireResist;
            coldResistValueSpan.textContent = coldResist;
            lightningResistValueSpan.textContent = lightningResist;

            let damageConvertedToFire = incomingDamage * (physTakenFire / 100);
            let damageConvertedToCold = incomingDamage * (physTakenCold / 100);
            let damageConvertedToLightning = incomingDamage * (physTakenLightning / 100);

            let rawPhysicalDamageAfterConversion = Math.max(0, incomingDamage - (damageConvertedToFire + damageConvertedToCold + damageConvertedToLightning));

            let armourPDR = 0;
            if (rawPhysicalDamageAfterConversion > 0 && armour > 0) {
                armourPDR = (armour / (armour + (10 * rawPhysicalDamageAfterConversion))) * 100;
                armourPDR = Math.min(90, armourPDR);
            }
            armourPDRDisplay.textContent = `PDR from Armour: ${armourPDR.toFixed(2)}% (vs ${rawPhysicalDamageAfterConversion.toFixed(0)} phys)`; /* Changed label */

            let endurancePhysDR = enduranceCharges * 4;
            let combinedPhysicalDR = armourPDR + endurancePhysDR + otherPhysDR;
            combinedPhysicalDR = Math.min(90, combinedPhysicalDR);

            totalPhysDRDisplayInput.value = combinedPhysicalDR;
            totalPhysDRValueSpan.textContent = combinedPhysicalDR.toFixed(2);

            let effectivePhysicalDamage = rawPhysicalDamageAfterConversion * (1 - (combinedPhysicalDR / 100));
            effectivePhysicalDamage = Math.max(0, effectivePhysicalDamage - flatPhysTaken);

            let mitigatedFireDamage = damageConvertedToFire * (1 - (fireResist / 100));
            let mitigatedColdDamage = damageConvertedToCold * (1 - (coldResist / 100));
            let mitigatedLightningDamage = damageConvertedToLightning * (1 - (lightningResist / 100));

            let enduranceEleDRFactor = (1 - (enduranceCharges * 0.04));
            enduranceEleDRFactor = Math.max(0, enduranceEleDRFactor);

            mitigatedFireDamage *= enduranceEleDRFactor;
            mitigatedColdDamage *= enduranceEleDRFactor;
            mitigatedLightningDamage *= enduranceEleDRFactor;

            let finalDamage = effectivePhysicalDamage + mitigatedFireDamage + mitigatedColdDamage + mitigatedLightningDamage;

            finalDamageOutput.textContent = finalDamage.toFixed(2);
            finalPhysDmgSpan.textContent = effectivePhysicalDamage.toFixed(2);
            finalFireDmgSpan.textContent = mitigatedFireDamage.toFixed(2);
            finalColdDmgSpan.textContent = mitigatedColdDamage.toFixed(2);
            finalLightningDmgSpan.textContent = mitigatedLightningDamage.toFixed(2);
        }

        incomingPhysDamageInput.addEventListener('input', calculateDamage);
        enduranceChargesInput.addEventListener('input', calculateDamage);
        flatPhysTakenInput.addEventListener('input', calculateDamage);
        physTakenFireInput.addEventListener('input', calculateDamage);
        physTakenColdInput.addEventListener('input', calculateDamage);
        physTakenLightningInput.addEventListener('input', calculateDamage);
        armourInput.addEventListener('input', calculateDamage);
        otherPhysDRInput.addEventListener('input', calculateDamage);
        fireResistInput.addEventListener('input', calculateDamage);
        coldResistInput.addEventListener('input', calculateDamage);
        lightningResistInput.addEventListener('input', calculateDamage);

        calculateDamage();
    </script>
</body>
</html>
